<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>One‚ÄëClick: Add Tenderly Mainnet (Virtual) RPC</title>
  <meta name="description" content="One‚Äëclick button to add/switch to a Tenderly Virtual Mainnet RPC in EVM wallets like TokenPocket or MetaMask." />
  <style>
    :root{
      --bg:#0b1020;--card:#121732;--text:#e6e8ef;--muted:#a6adcc;--accent:#6ee7ff;--line:#272c45;--ok:#20d37a;--warn:#ffd166;--err:#ff6b6b
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Sego e UI,Roboto,Inter,Helvetica,Arial,sans-serif;display:flex;min-height:100vh;align-items:center;justify-content:center}
    .card{width:min(760px,92vw);background:var(--card);border:1px solid var(--line);border-radius:20px;padding:28px;box-shadow:0 12px 32px rgba(0,0,0,.35)}
    h1{font-size:22px;margin:0 0 10px}
    p{margin:6px 0 12px;line-height:1.55;color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0 8px}
    button{appearance:none;border:1px solid var(--line);background:#0f1430;color:var(--text);padding:12px 16px;border-radius:14px;font-weight:600;cursor:pointer}
    button:hover{border-color:#3a4070}
    .primary{background:linear-gradient(135deg,#3aa6ff,#7ef3ff);color:#071019;border-color:transparent}
    .ghost{background:transparent}
    code, .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, Liberation Mono, monospace}
    .kbd{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:8px;padding:2px 8px;font-size:12px;color:var(--muted)}
    .status{margin-top:14px;padding:12px;border:1px dashed var(--line);border-radius:12px;font-size:14px;min-height:48px;white-space:pre-wrap}
    .ok{color:var(--ok)}.warn{color:var(--warn)}.err{color:var(--err)}
    .hr{height:1px;background:linear-gradient(90deg,transparent,var(--line),transparent);margin:18px 0}
    .foot{opacity:.75;font-size:12px}
    .small{font-size:13px;color:var(--muted)}
    .tag{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-size:12px;margin-right:8px}
  </style>
</head>
<body>
  <main class="card">
    <h1>One‚ÄëClick: Add Tenderly Mainnet (Virtual) RPC</h1>
    <p>This button attempts to add the RPC below to your EVM wallet (TokenPocket, MetaMask, Trust Wallet, etc.) via <span class="mono">wallet_addEthereumChain</span>. If your wallet already has Ethereum Mainnet, it will try to switch to it using this RPC. Works best in an in‚Äëapp DApp browser.</p>

    <div class="row">
      <span class="tag"><strong>Chain:</strong> Ethereum Mainnet (virtual)</span>
      <span class="tag"><strong>Chain ID:</strong> 1 (0x1)</span>
      <span class="tag"><strong>Symbol:</strong> ETH</span>
    </div>

    <div class="hr"></div>

    <p class="small"><strong>RPC URL</strong></p>
    <p class="mono" id="rpcText">https://virtual.mainnet.us-west.rpc.tenderly.co/69c4db98-0c54-4806-b9cf-6093ad8b8080</p>
    <div class="row">
      <button class="ghost" id="copyBtn">Copy RPC URL</button>
      <button class="ghost" id="testBtn">Test RPC (HEAD)</button>
    </div>

    <div class="hr"></div>

    <div class="row">
      <button class="primary" id="addBtn">‚ûï Add / Switch Network</button>
      <button id="connectBtn">üîå Connect Wallet</button>
      <button id="switchBtn">üîÅ Switch to Mainnet (0x1)</button>
    </div>

    <div id="status" class="status">Ready.</div>

    <p class="foot">Tips: If MetaMask blocks adding a duplicate chain ID (0x1), open this page inside <strong>TokenPocket</strong> or your wallet‚Äôs in‚Äëapp browser and tap <em>Add / Switch Network</em> again. Many wallets accept the new RPC, even for chain 0x1.</p>
  </main>

<script>
(function(){
  const rpcUrl = 'https://virtual.mainnet.us-west.rpc.tenderly.co/69c4db98-0c54-4806-b9cf-6093ad8b8080';
  const chainIdHex = '0x1';
  const addParams = {
    chainId: chainIdHex,
    chainName: 'Tenderly Mainnet (Virtual)',
    nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
    rpcUrls: [rpcUrl],
    blockExplorerUrls: ['https://etherscan.io']
  };

  const $ = (id)=>document.getElementById(id);
  const log = (msg, cls) => {
    const el = $('status');
    el.textContent = (typeof msg === 'string') ? msg : JSON.stringify(msg, null, 2);
    el.className = 'status' + (cls ? ' ' + cls : '');
  };

  async function ensureProvider(){
    if (window.ethereum) return window.ethereum;
    // TokenPocket legacy provider
    if (window.tp && window.tp.isConnected) return window.tp;
    throw new Error('No EVM provider detected. Open this page in TokenPocket/MetaMask DApp browser.');
  }

  async function connect(){
    try{
      const provider = await ensureProvider();
      const accounts = await provider.request({ method: 'eth_requestAccounts' });
      log(`Connected: ${accounts[0] || 'No account'}`, 'ok');
    }catch(err){ log('Connect failed: ' + (err && err.message ? err.message : err), 'err'); }
  }

  async function addOrSwitch(){
    try{
      const provider = await ensureProvider();

      // Try add first
      try{
        await provider.request({ method: 'wallet_addEthereumChain', params: [addParams] });
        log('Network added. Switching‚Ä¶', 'ok');
      }catch(addErr){
        // If already exists or wallet forbids duplicate chain, we still attempt a switch.
        console.warn('add error', addErr);
        log('Add may be blocked or already present. Attempting to switch‚Ä¶', 'warn');
      }

      await provider.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: chainIdHex }] });
      log('Switched to Ethereum Mainnet (0x1). Your wallet should now use the Tenderly RPC.', 'ok');

    }catch(err){
      log('Add/Switch failed: ' + (err && err.message ? err.message : err), 'err');
    }
  }

  async function switchOnly(){
    try{
      const provider = await ensureProvider();
      await provider.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: chainIdHex }] });
      log('Switched to Ethereum Mainnet (0x1).', 'ok');
    }catch(err){
      log('Switch failed: ' + (err && err.message ? err.message : err), 'err');
    }
  }

  async function testRpc(){
    // Lightweight probe (no CORS preflight content) using HEAD
    try{
      const res = await fetch(rpcUrl, { method: 'HEAD', mode: 'no-cors' });
      log('RPC probe sent. If your browser blocks CORS, this is expected. Try from a wallet DApp browser.', 'warn');
    }catch(err){
      log('RPC probe failed (likely CORS) but may still work inside your wallet browser. ' + err, 'warn');
    }
  }

  $('addBtn').addEventListener('click', addOrSwitch);
  $('connectBtn').addEventListener('click', connect);
  $('switchBtn').addEventListener('click', switchOnly);
  $('copyBtn').addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(rpcUrl); log('RPC URL copied to clipboard.', 'ok'); }
    catch{ log('Copy failed ‚Äî select and copy manually.', 'warn'); }
  });
  $('testBtn').addEventListener('click', testRpc);
})();
</script>
</body>
</html>
